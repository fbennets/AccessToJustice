# Open Decision - Telegram Bot

Open Decision is an Open-Source Decision Automation System, that is optimized for legal processes. The system will be used to build a platform to provide free legal advice for consumers.

Try the Telegram Bot [here](https://t.me/opendecision_bot).

**This is the Telegram chatbot/interpreter to display decision trees generated by the Open Decision builder. For the main project, go [here](https://github.com/fbennets/open-decision).**


Further information about the project on www.open-decision.org

## Table of content
- [Getting Started](#getting-started)
    - [Set-up a VPS & start your bot](#set-up-a-vps--start-your-bot)
    - [Use your own builder instance](#use-your-own-builder-instance)
    - [Provide a demo ](#provide-a-demo )
- [Known Issues](#known-issues)
- [Built with](#built-with)
- [Contributing](#contributing)
- [License](#license)
- [Links](#links)


## Getting Started
The Telegram bot hosted by the [Open Decision project](https://open-decision.org) using the handle [@opendecision_bot](https://t.me/opendecision_bot) can display any tree generated using the hosted builder at [builder.open-decision.org](builder.open-decision.org).   
If you want to host your own bot to (1) display decision trees from the hosted builder with your own branding or (2) want to display trees from a self-hosted instance of Open Decision, follow this tutorial.

The bot can display trees, that have been published using the Open Decision builder. It uses the unique identifier (like 'habbizvzxt') to load a tree from the builder using a get request.

The current bot version is not production-ready and only for testing purposes.

## Prerequisites
To deploy your own bot, you need to create a Telegram Bot Account and get your API token (treat it like a password and keep it secret). To do so, talk to the [Botfather](https://t.me/botfather) on Telegram and follow the instructions. For more information, [see here](https://core.telegram.org/bots#6-botfather).  

## Recommended: Deploy on Heroku
The easiest way to deploy your own instance of the Open Decision Telegram Bot is using the free Heroku plan. First, click the Deploy-button below. If you don't have a Heroku account, you need to register for free.

[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)

### Basic Configuration
 Enter a name in the "Create New App" dialog opening after you clicked the Deploy-button. The App name doesn't matter to much, as users of your bot will never see the name.

Enter your API Token (see [here](#prerequisites) in the "OD_BOT_TOKEN" field of the "Config Vars" section.

```bash
# Example:
644739147:AAGMPo-Jz3mKRnHRTnrPEDi7jUF1vqNOD5k

```
Enter the name of your App you just set above in the "OD_BOT_HEROKU_APP_NAME" field.

```bash
# Example:
mytelegrambot
```

You should enter your public Telegram username in the "OD_BOT_ADMINS" field. You can enter multiple usernames by seperating the with a comma. Every user in this list can customise the bot on the fly on Telegram. If you don't have a username on Telegram, you can set one in the [Telegram settings](https://telegram.org/faq#q-what-are-usernames-how-do-i-get-one).

```bash
# Example:
admin1, admin2
```

If you're using your own (self-hosted) instance of the Open Decision builder, set "OD_BOT_BUILDER_URL" to your custom domain.

```bash
# Default value is:
https://builder.open-decision.org
```
For additional configuration options, see here. However, all settings except for the three above can be set using the Admin-Settings of the Bot using Telegram.

### Finish Heroku Deployment
Click the "Deploy app" button to finish the deployment. Heroku will deploy your bot. After the deployment is finished, you can contact your bot on Telegram using the Link you received from the Botfather or by searching your bot's name on Telegram.
If you want to change you API token, the bot admins or the Builder URL, you can do so in the Heroku Dashboard, under Settings in the Config Vars section.
All other settings can be made using the built-in settings of the Bot using Telegram.

## Manual Deployment
You can deploy the bot on any Virtual Private Server (VPS) or Cloud Service supporting Python 3 - which should be nearly every one.

### Set-up a VPS & start your bot
You need to set up a VPS to run the bot. There are plenty of tutorials online.  
Take a look at the  [hoster list](https://github.com/python-telegram-bot/python-telegram-bot/wiki/Where-to-host-Telegram-Bots) for some suggestions on where to host your bot. From our experience, [Uberspace](https://uberspace.de/en/) is awesome to get your bot up and running quickly.

Use SSH to get a shell on you VPS and clone this repository using:
```
git clone https://github.com/fbennets/Open-Decision-Telegram-Bot.git bot
```
Next install the requirements.

```bash
# Install dependencies
cd bot
pip install -r requirements.txt
```

Then, you need to set your API token as an environment variable. Enter this in your shell:
```bash
export OD_BOT_TOKEN=YourTokenHere

# The command should look like this:
# export OD_BOT_TOKEN=644739147:AAGMPo-Jz3mKRnHRTnrPEDi7jUF1vqNOD5k
```
Great, now you can start your bot using:
``` bash
python od-telegram-bot.py

#If Python 3 is not your default version, try:
python od-telegram-bot.py
```

For a more detailed tutorial on how to deploy the bot, [see here](https://github.com/python-telegram-bot/python-telegram-bot/wiki/Hosting-your-bot).  

If you leave the shell, your bot will usually stop working. To prevent this, use a terminal multiplexer like screen. [See here](https://github.com/python-telegram-bot/python-telegram-bot/wiki/Hosting-your-bot#start-your-bot) for more information.

### Use your own builder instance
If you want to use your self-hosted instance of the Open Decision builder, you need to set the callback URL to your custom domain.
```bash
export OD_BOT_URL=https://YourDomain.com
#By default, the bot uses https://builder.open-decision.org
```
### Provide a demo
You can provide a demo-tree for your bot. When users start a conversation with your bot, they can choose to see a demo query.  
You can find the identifier of your published tree in the "Published Trees" section in the builder or in the URL of a published tree.
```bash
export OD_BOT_DEMO_QUERY=YourTreeIdentifier
#URL of the published tree: https://builder.open-decision.org/publish/habbizvzxt/
#Example command: export OD_BOT_DEMO_QUERY=habbizvzxt
```
## Known Issues
- Slow answers: Depending on your server speed, the bot answers quite slowly. The bot is currently not production ready. The bot mode will be switched from polling to webhook soon, to increase the speed.

## Built with
- Python-Telegram-Bot
- JSONlogic


## Contributing

Please read [CONTRIBUTING.md](https://github.com/fbennets/open-decision/blob/master/CONTRIBUTING.md) for details on our code of conduct, and the process for submitting pull requests to us.

## License

This project is licensed under the MIT License - see the [LICENSE](https://github.com/fbennets/open-decision/blob/master/LICENSE) file for details.

## Links

* [Project Website](http://open-decision.org)
* [Open Decision Builder](https://github.com/fbennets/open-decision)
